(window["webpackJsonpCMSBrowserComponents"] = window["webpackJsonpCMSBrowserComponents"] || []).push([["vendors~identity-x-authenticate"],{

/***/ "../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue":
/*!**********************************************************************************!*\
  !*** /root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue ***!
  \**********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./authenticate.vue?vue&type=template&id=5fb1bbc5& */ "../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5&");
/* harmony import */ var _authenticate_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./authenticate.vue?vue&type=script&lang=js& */ "../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js&");
/* empty/unused harmony star reexport *//* harmony import */ var _vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../vue-loader/lib/runtime/componentNormalizer.js */ "../../node_modules/vue-loader/lib/runtime/componentNormalizer.js");





/* normalize component */

var component = Object(_vue_loader_lib_runtime_componentNormalizer_js__WEBPACK_IMPORTED_MODULE_2__["default"])(
  _authenticate_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_1__["default"],
  _authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__["render"],
  _authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"],
  false,
  null,
  null,
  null
  
)

/* hot reload */
if (false) { var api; }
component.options.__file = "node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue"
/* harmony default export */ __webpack_exports__["default"] = (component.exports);

/***/ }),

/***/ "../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js&":
/*!***********************************************************************************************************!*\
  !*** /root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js& ***!
  \***********************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _babel_loader_lib_index_js_ref_1_vue_loader_lib_index_js_vue_loader_options_authenticate_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../babel-loader/lib??ref--1!../../../vue-loader/lib??vue-loader-options!./authenticate.vue?vue&type=script&lang=js& */ "../../node_modules/babel-loader/lib/index.js?!../../node_modules/vue-loader/lib/index.js?!../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js&");
/* empty/unused harmony star reexport */ /* harmony default export */ __webpack_exports__["default"] = (_babel_loader_lib_index_js_ref_1_vue_loader_lib_index_js_vue_loader_options_authenticate_vue_vue_type_script_lang_js___WEBPACK_IMPORTED_MODULE_0__["default"]); 

/***/ }),

/***/ "../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5&":
/*!*****************************************************************************************************************!*\
  !*** /root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5& ***!
  \*****************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _vue_loader_lib_loaders_templateLoader_js_vue_loader_options_vue_loader_lib_index_js_vue_loader_options_authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! -!../../../vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../vue-loader/lib??vue-loader-options!./authenticate.vue?vue&type=template&id=5fb1bbc5& */ "../../node_modules/vue-loader/lib/loaders/templateLoader.js?!../../node_modules/vue-loader/lib/index.js?!../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5&");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "render", function() { return _vue_loader_lib_loaders_templateLoader_js_vue_loader_options_vue_loader_lib_index_js_vue_loader_options_authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__["render"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return _vue_loader_lib_loaders_templateLoader_js_vue_loader_options_vue_loader_lib_index_js_vue_loader_options_authenticate_vue_vue_type_template_id_5fb1bbc5___WEBPACK_IMPORTED_MODULE_0__["staticRenderFns"]; });



/***/ }),

/***/ "../../node_modules/@base-cms/marko-web-identity-x/browser/errors/authentication.js":
/*!******************************************************************************************!*\
  !*** /root/node_modules/@base-cms/marko-web-identity-x/browser/errors/authentication.js ***!
  \******************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return AuthenticationError; });
/* harmony import */ var _root_node_modules_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/classCallCheck */ "../../node_modules/@babel/runtime/helpers/classCallCheck.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/possibleConstructorReturn */ "../../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/getPrototypeOf */ "../../node_modules/@babel/runtime/helpers/getPrototypeOf.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/inherits */ "../../node_modules/@babel/runtime/helpers/inherits.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_wrapNativeSuper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/wrapNativeSuper */ "../../node_modules/@babel/runtime/helpers/wrapNativeSuper.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_wrapNativeSuper__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_wrapNativeSuper__WEBPACK_IMPORTED_MODULE_4__);






var AuthenticationError =
/*#__PURE__*/
function (_Error) {
  _root_node_modules_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_3___default()(AuthenticationError, _Error);

  function AuthenticationError(message) {
    var _this;

    var code = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;

    _root_node_modules_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default()(this, AuthenticationError);

    _this = _root_node_modules_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_1___default()(this, _root_node_modules_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2___default()(AuthenticationError).call(this, message));
    _this.name = 'AuthenticationError';
    _this.code = code;
    return _this;
  }

  return AuthenticationError;
}(_root_node_modules_babel_runtime_helpers_wrapNativeSuper__WEBPACK_IMPORTED_MODULE_4___default()(Error));



/***/ }),

/***/ "../../node_modules/@base-cms/marko-web-identity-x/browser/utils/redirect.js":
/*!***********************************************************************************!*\
  !*** /root/node_modules/@base-cms/marko-web-identity-x/browser/utils/redirect.js ***!
  \***********************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _clean_path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./clean-path */ "../../node_modules/@base-cms/marko-web-identity-x/browser/utils/clean-path.js");

/* harmony default export */ __webpack_exports__["default"] = (function (to) {
  var path = Object(_clean_path__WEBPACK_IMPORTED_MODULE_0__["default"])(to);
  var url = "".concat(window.location.origin, "/").concat(path);
  window.location.replace(url);
});

/***/ }),

/***/ "../../node_modules/babel-loader/lib/index.js?!../../node_modules/vue-loader/lib/index.js?!../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js&":
/*!*************************************************************************************************************************************************************************************************************!*\
  !*** /root/node_modules/babel-loader/lib??ref--1!/root/node_modules/vue-loader/lib??vue-loader-options!/root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=script&lang=js& ***!
  \*************************************************************************************************************************************************************************************************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _root_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/regenerator */ "../../node_modules/@babel/runtime/regenerator/index.js");
/* harmony import */ var _root_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/asyncToGenerator */ "../../node_modules/@babel/runtime/helpers/asyncToGenerator.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _root_node_modules_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! /root/node_modules/@babel/runtime/helpers/toConsumableArray */ "../../node_modules/@babel/runtime/helpers/toConsumableArray.js");
/* harmony import */ var _root_node_modules_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_root_node_modules_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _utils_redirect__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/redirect */ "../../node_modules/@base-cms/marko-web-identity-x/browser/utils/redirect.js");
/* harmony import */ var _utils_cookies_enabled__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/cookies-enabled */ "../../node_modules/@base-cms/marko-web-identity-x/browser/utils/cookies-enabled.js");
/* harmony import */ var _utils_post__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/post */ "../../node_modules/@base-cms/marko-web-identity-x/browser/utils/post.js");
/* harmony import */ var _profile_vue__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./profile.vue */ "../../node_modules/@base-cms/marko-web-identity-x/browser/profile.vue");
/* harmony import */ var _errors_authentication__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./errors/authentication */ "../../node_modules/@base-cms/marko-web-identity-x/browser/errors/authentication.js");
/* harmony import */ var _errors_feature__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./errors/feature */ "../../node_modules/@base-cms/marko-web-identity-x/browser/errors/feature.js");



//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//







var isEmpty = function isEmpty(v) {
  return v == null || v === '';
};

/* harmony default export */ __webpack_exports__["default"] = ({
  /**
   *
   */
  components: {
    ProfileForm: _profile_vue__WEBPACK_IMPORTED_MODULE_6__["default"]
  },

  /**
   *
   */
  props: {
    token: {
      type: String,
      required: true
    },
    endpoints: {
      type: Object,
      required: true
    },
    redirectTo: {
      type: String,
      default: '/'
    },
    requiredServerFields: {
      type: Array,
      default: function _default() {
        return [];
      }
    },
    requiredClientFields: {
      type: Array,
      default: function _default() {
        return [];
      }
    },
    consentPolicy: {
      type: String,
      default: null
    },
    emailConsentRequest: {
      type: String,
      default: null
    },
    regionalConsentPolicies: {
      type: Array,
      default: function _default() {
        return [];
      }
    }
  },

  /**
   *
   */
  data: function data() {
    return {
      error: null,
      isLoading: false,
      isRedirecting: false,
      isProfileComplete: true,
      activeUser: null
    };
  },

  /**
   *
   */
  computed: {
    /**
     *
     */
    requiredFields: function requiredFields() {
      return [].concat(_root_node_modules_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_2___default()(this.requiredServerFields), _root_node_modules_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_2___default()(this.requiredClientFields));
    },

    /**
     *
     */
    hasRequiredFields: function hasRequiredFields() {
      return Boolean(this.requiredFields.length);
    },
    isUserRedirect: function isUserRedirect() {
      var redirectTo = this.redirectTo;
      var _this$endpoints = this.endpoints,
          login = _this$endpoints.login,
          register = _this$endpoints.register;
      if (redirectTo.indexOf(login) === 0) return true;
      if (redirectTo.indexOf(register) === 0) return true;
      return false;
    },

    /**
     *
     */
    showProfileForm: function showProfileForm() {
      return !this.hasRequiredFields || this.isUserRedirect && !this.isProfileComplete;
    }
  },

  /**
   *
   */
  mounted: function mounted() {
    if (Object(_utils_cookies_enabled__WEBPACK_IMPORTED_MODULE_4__["default"])()) {
      this.authenticate();
    } else {
      this.error = new _errors_feature__WEBPACK_IMPORTED_MODULE_8__["default"]('Your browser does not support cookies. Please enable cookies to use this feature.');
    }
  },

  /**
   *
   */
  methods: {
    /**
     *
     */
    authenticate: function () {
      var _authenticate = _root_node_modules_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1___default()(
      /*#__PURE__*/
      _root_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.mark(function _callee() {
        var _this = this;

        var token, res, data;
        return _root_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default.a.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                this.isLoading = true;
                _context.prev = 1;
                token = this.token;

                if (token) {
                  _context.next = 5;
                  break;
                }

                throw new Error('No login token was provided.');

              case 5:
                _context.next = 7;
                return Object(_utils_post__WEBPACK_IMPORTED_MODULE_5__["default"])('/authenticate', {
                  token: token
                });

              case 7:
                res = _context.sent;
                _context.next = 10;
                return res.json();

              case 10:
                data = _context.sent;

                if (res.ok) {
                  _context.next = 13;
                  break;
                }

                throw new _errors_authentication__WEBPACK_IMPORTED_MODULE_7__["default"](data.message, res.status);

              case 13:
                this.activeUser = data.user;
                this.isProfileComplete = this.hasRequiredFields ? this.requiredFields.every(function (key) {
                  return !isEmpty(_this.activeUser[key]);
                }) : true;
                this.$emit('authenticate');
                if (!this.showProfileForm) this.redirect();
                _context.next = 23;
                break;

              case 19:
                _context.prev = 19;
                _context.t0 = _context["catch"](1);

                if (/no token was found/i.test(_context.t0.message)) {
                  _context.t0.message = 'This login link has either expired or was already used.';
                }

                this.error = _context.t0;

              case 23:
                _context.prev = 23;
                this.isLoading = false;
                return _context.finish(23);

              case 26:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this, [[1, 19, 23, 26]]);
      }));

      function authenticate() {
        return _authenticate.apply(this, arguments);
      }

      return authenticate;
    }(),

    /**
     *
     */
    redirect: function redirect() {
      this.isRedirecting = true;
      var redirectTo = this.isUserRedirect ? '/' : this.redirectTo;

      Object(_utils_redirect__WEBPACK_IMPORTED_MODULE_3__["default"])(redirectTo);
    }
  }
});

/***/ }),

/***/ "../../node_modules/vue-loader/lib/loaders/templateLoader.js?!../../node_modules/vue-loader/lib/index.js?!../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5&":
/*!*******************************************************************************************************************************************************************************************************************************************************!*\
  !*** /root/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!/root/node_modules/vue-loader/lib??vue-loader-options!/root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?vue&type=template&id=5fb1bbc5& ***!
  \*******************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "render", function() { return render; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "staticRenderFns", function() { return staticRenderFns; });
var render = function() {
  var _vm = this
  var _h = _vm.$createElement
  var _c = _vm._self._c || _h
  return _vm.isRedirecting
    ? _c("div", [
        _c("p", [_vm._v("You've successfully logged in. Redirecting you...")])
      ])
    : _vm.isLoading
    ? _c("div", [_c("p", [_vm._v("Logging in...")])])
    : _vm.showProfileForm
    ? _c(
        "div",
        [
          _c("profile-form", {
            attrs: {
              endpoints: _vm.endpoints,
              "active-user": _vm.activeUser,
              "required-server-fields": _vm.requiredServerFields,
              "required-client-fields": _vm.requiredClientFields,
              "consent-policy": _vm.consentPolicy,
              "email-consent-request": _vm.emailConsentRequest,
              "regional-consent-policies": _vm.regionalConsentPolicies
            },
            on: { submit: _vm.redirect }
          })
        ],
        1
      )
    : _vm.error
    ? _c(
        "div",
        { staticClass: "alert alert-danger", attrs: { role: "alert" } },
        [
          _c("h5", { staticClass: "alert-heading" }, [
            _vm._v("\n    Unable to Login\n  ")
          ]),
          _vm._v(" "),
          _c("p", [_vm._v(_vm._s(_vm.error.message))]),
          _vm._v(" "),
          _c("hr"),
          _vm._v(" "),
          _c("p", { staticClass: "mb-0" }, [
            _vm._v("\n    Please try "),
            _c(
              "a",
              {
                staticClass: "alert-link",
                attrs: { href: _vm.endpoints.login }
              },
              [_vm._v("logging in")]
            ),
            _vm._v(" again.\n  ")
          ])
        ]
      )
    : _vm._e()
}
var staticRenderFns = []
render._withStripped = true



/***/ })

}]);
//# sourceMappingURL=vendors~identity-x-authenticate.7e4f7167.js.map