{"version":3,"sources":["webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?4220","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?9896","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/errors/authentication.js","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/utils/redirect.js","webpack://CMSBrowserComponents/../../node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue?837d"],"names":["AuthenticationError","message","code","name","Error","to","path","cleanPath","url","window","location","origin","replace"],"mappings":"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","file":"vendors~identity-x-authenticate.7e4f7167.js","sourcesContent":["import { render, staticRenderFns } from \"./authenticate.vue?vue&type=template&id=5fb1bbc5&\"\nimport script from \"./authenticate.vue?vue&type=script&lang=js&\"\nexport * from \"./authenticate.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/root/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('5fb1bbc5')) {\n      api.createRecord('5fb1bbc5', component.options)\n    } else {\n      api.reload('5fb1bbc5', component.options)\n    }\n    module.hot.accept(\"./authenticate.vue?vue&type=template&id=5fb1bbc5&\", function () {\n      api.rerender('5fb1bbc5', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"node_modules/@base-cms/marko-web-identity-x/browser/authenticate.vue\"\nexport default component.exports","import mod from \"-!../../../babel-loader/lib/index.js??ref--1!../../../vue-loader/lib/index.js??vue-loader-options!./authenticate.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../babel-loader/lib/index.js??ref--1!../../../vue-loader/lib/index.js??vue-loader-options!./authenticate.vue?vue&type=script&lang=js&\"","export * from \"-!../../../vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../vue-loader/lib/index.js??vue-loader-options!./authenticate.vue?vue&type=template&id=5fb1bbc5&\"","export default class AuthenticationError extends Error {\n  constructor(message, code = 500) {\n    super(message);\n    this.name = 'AuthenticationError';\n    this.code = code;\n  }\n}\n","import cleanPath from './clean-path';\n\nexport default (to) => {\n  const path = cleanPath(to);\n  const url = `${window.location.origin}/${path}`;\n  window.location.replace(url);\n};\n","<template>\n  <div v-if=\"isRedirecting\">\n    <p>You've successfully logged in. Redirecting you...</p>\n  </div>\n  <div v-else-if=\"isLoading\">\n    <p>Logging in...</p>\n  </div>\n  <div v-else-if=\"showProfileForm\">\n    <profile-form\n      :endpoints=\"endpoints\"\n      :active-user=\"activeUser\"\n      :required-server-fields=\"requiredServerFields\"\n      :required-client-fields=\"requiredClientFields\"\n      :consent-policy=\"consentPolicy\"\n      :email-consent-request=\"emailConsentRequest\"\n      :regional-consent-policies=\"regionalConsentPolicies\"\n      @submit=\"redirect\"\n    />\n  </div>\n  <div v-else-if=\"error\" class=\"alert alert-danger\" role=\"alert\">\n    <h5 class=\"alert-heading\">\n      Unable to Login\n    </h5>\n    <p>{{ error.message }}</p>\n    <hr>\n    <p class=\"mb-0\">\n      Please try <a :href=\"endpoints.login\" class=\"alert-link\">logging in</a> again.\n    </p>\n  </div>\n</template>\n\n<script>\nimport redirect from './utils/redirect';\nimport cookiesEnabled from './utils/cookies-enabled';\nimport post from './utils/post';\nimport ProfileForm from './profile.vue';\nimport AuthenticationError from './errors/authentication';\nimport FeatureError from './errors/feature';\n\nconst isEmpty = v => v == null || v === '';\n\nexport default {\n  /**\n   *\n   */\n  components: { ProfileForm },\n\n  /**\n   *\n   */\n  props: {\n    token: {\n      type: String,\n      required: true,\n    },\n    endpoints: {\n      type: Object,\n      required: true,\n    },\n    redirectTo: {\n      type: String,\n      default: '/',\n    },\n    requiredServerFields: {\n      type: Array,\n      default: () => [],\n    },\n    requiredClientFields: {\n      type: Array,\n      default: () => [],\n    },\n    consentPolicy: {\n      type: String,\n      default: null,\n    },\n    emailConsentRequest: {\n      type: String,\n      default: null,\n    },\n    regionalConsentPolicies: {\n      type: Array,\n      default: () => [],\n    },\n  },\n\n  /**\n   *\n   */\n  data: () => ({\n    error: null,\n    isLoading: false,\n    isRedirecting: false,\n    isProfileComplete: true,\n    activeUser: null,\n  }),\n\n  /**\n   *\n   */\n  computed: {\n    /**\n     *\n     */\n    requiredFields() {\n      return [...this.requiredServerFields, ...this.requiredClientFields];\n    },\n\n    /**\n     *\n     */\n    hasRequiredFields() {\n      return Boolean(this.requiredFields.length);\n    },\n\n    isUserRedirect() {\n      const { redirectTo } = this;\n      const { login, register } = this.endpoints;\n      if (redirectTo.indexOf(login) === 0) return true;\n      if (redirectTo.indexOf(register) === 0) return true;\n      return false;\n    },\n\n    /**\n     *\n     */\n    showProfileForm() {\n      return !this.hasRequiredFields || (this.isUserRedirect && !this.isProfileComplete);\n    },\n  },\n\n  /**\n   *\n   */\n  mounted() {\n    if (cookiesEnabled()) {\n      this.authenticate();\n    } else {\n      this.error = new FeatureError('Your browser does not support cookies. Please enable cookies to use this feature.');\n    }\n  },\n\n  /**\n   *\n   */\n  methods: {\n    /**\n     *\n     */\n    async authenticate() {\n      this.isLoading = true;\n      try {\n        const { token } = this;\n        if (!token) throw new Error('No login token was provided.');\n\n        const res = await post('/authenticate', { token });\n        const data = await res.json();\n\n        if (!res.ok) throw new AuthenticationError(data.message, res.status);\n\n        this.activeUser = data.user;\n        this.isProfileComplete = this.hasRequiredFields\n          ? this.requiredFields.every(key => !isEmpty(this.activeUser[key]))\n          : true;\n\n        this.$emit('authenticate');\n        if (!this.showProfileForm) this.redirect();\n      } catch (e) {\n        if (/no token was found/i.test(e.message)) {\n          e.message = 'This login link has either expired or was already used.';\n        }\n        this.error = e;\n      } finally {\n        this.isLoading = false;\n      }\n    },\n\n    /**\n     *\n     */\n    redirect() {\n      this.isRedirecting = true;\n      const redirectTo = this.isUserRedirect ? '/' : this.redirectTo;\n      redirect(redirectTo);\n    },\n  },\n};\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _vm.isRedirecting\n    ? _c(\"div\", [\n        _c(\"p\", [_vm._v(\"You've successfully logged in. Redirecting you...\")])\n      ])\n    : _vm.isLoading\n    ? _c(\"div\", [_c(\"p\", [_vm._v(\"Logging in...\")])])\n    : _vm.showProfileForm\n    ? _c(\n        \"div\",\n        [\n          _c(\"profile-form\", {\n            attrs: {\n              endpoints: _vm.endpoints,\n              \"active-user\": _vm.activeUser,\n              \"required-server-fields\": _vm.requiredServerFields,\n              \"required-client-fields\": _vm.requiredClientFields,\n              \"consent-policy\": _vm.consentPolicy,\n              \"email-consent-request\": _vm.emailConsentRequest,\n              \"regional-consent-policies\": _vm.regionalConsentPolicies\n            },\n            on: { submit: _vm.redirect }\n          })\n        ],\n        1\n      )\n    : _vm.error\n    ? _c(\n        \"div\",\n        { staticClass: \"alert alert-danger\", attrs: { role: \"alert\" } },\n        [\n          _c(\"h5\", { staticClass: \"alert-heading\" }, [\n            _vm._v(\"\\n    Unable to Login\\n  \")\n          ]),\n          _vm._v(\" \"),\n          _c(\"p\", [_vm._v(_vm._s(_vm.error.message))]),\n          _vm._v(\" \"),\n          _c(\"hr\"),\n          _vm._v(\" \"),\n          _c(\"p\", { staticClass: \"mb-0\" }, [\n            _vm._v(\"\\n    Please try \"),\n            _c(\n              \"a\",\n              {\n                staticClass: \"alert-link\",\n                attrs: { href: _vm.endpoints.login }\n              },\n              [_vm._v(\"logging in\")]\n            ),\n            _vm._v(\" again.\\n  \")\n          ])\n        ]\n      )\n    : _vm._e()\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }"],"sourceRoot":""}