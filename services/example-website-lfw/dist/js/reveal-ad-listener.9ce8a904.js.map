{"version":3,"sources":["webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue?aa39","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue?49ce","webpack://CMSBrowserComponents/../../node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue","webpack://CMSBrowserComponents//root/node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue?6822"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAuF;AAC3B;AACL;;;AAGvD;AACgF;AAChF,gBAAgB,8FAAU;AAC1B,EAAE,8EAAM;AACR,EAAE,mFAAM;AACR,EAAE,4FAAe;AACjB;AACA;AACA;AACA;;AAEA;;AAEA;AACA,IAAI,KAAU,EAAE,YAiBf;AACD;AACe,gF;;;;;;;;;;;;ACtCf;AAAA;AAAA,wCAA4J,CAAgB,wNAAG,EAAC,C;;;;;;;;;;;;ACAhL;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;ACKA;;AAEA;AACA;AACA;AACA,GAFA,CAEA;AACA;AACA;AACA,CANA;;AAQA;AACA;AAEA;AACA;AACA;AACA,kBADA;AAEA;AAFA,KADA;AAKA;AACA,kBADA;AAEA;AAFA,KALA;AASA;AACA,kBADA;AAEA;AAAA;AAAA;AAAA;AAAA;AAFA,KATA;AAaA;AACA,mBADA;AAEA;AAFA;AAbA,GADA;AAmBA;AAAA;AACA,iBADA;AAEA,oBAFA;AAGA;AAHA;AAAA,GAnBA;AAwBA,SAxBA,qBAwBA;AACA;AACA,GA1BA;AA2BA,eA3BA,2BA2BA;AACA;AACA;AACA,GA9BA;AA+BA;AACA,qBADA,+BACA;AAAA,0BAKA,YALA;AAAA,UAEA,UAFA,iBAEA,UAFA;AAAA,UAGA,eAHA,iBAGA,eAHA;AAAA,UAIA,mBAJA,iBAIA,mBAJA;AAOA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA,KAZA;AAaA,aAbA,qBAaA,OAbA,EAaA;AACA;AADA,2BAOA,YAPA;AAAA,UAGA,UAHA,kBAGA,UAHA;AAAA,UAIA,WAJA,kBAIA,WAJA;AAAA,UAKA,OALA,kBAKA,OALA;AAAA,UAMA,SANA,kBAMA,SANA;AASA;AACA;AACA;AACA,wBADA;AAEA,sBAFA;AAGA,sBAHA;AAIA;AAJA,SAKA,MALA,CAKA;AAAA;AAAA;AAAA,QALA;AAMA;AACA,KA/BA;AAgCA,iBAhCA,2BAgCA;AAAA,UACA,gBADA,GACA,IADA,CACA,gBADA;AAEA;AACA;AACA,KApCA;AAqCA,oBArCA,8BAqCA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAZA;AAaA;;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA,KAxDA;AAyDA,YAzDA,oBAyDA,KAzDA,EAyDA;AAAA;;AACA;;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA,KAlEA;AAmEA,WAnEA,mBAmEA,OAnEA,EAmEA;AACA,6CACA,sCADA,GACA,qCADA;AAEA;AACA;;AACA;AACA;AACA;;AACA;AACA;AACA;AA7EA;AA/BA,G;;;;;;;;;;;;AClBA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,oBAAoB,SAAS,qCAAqC,EAAE;AACpE;AACA;AACA","file":"reveal-ad-listener.9ce8a904.js","sourcesContent":["import { render, staticRenderFns } from \"./listener.vue?vue&type=template&id=e57aac98&\"\nimport script from \"./listener.vue?vue&type=script&lang=js&\"\nexport * from \"./listener.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/root/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('e57aac98')) {\n      api.createRecord('e57aac98', component.options)\n    } else {\n      api.reload('e57aac98', component.options)\n    }\n    module.hot.accept(\"./listener.vue?vue&type=template&id=e57aac98&\", function () {\n      api.rerender('e57aac98', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"node_modules/@base-cms/marko-web-reveal-ad/browser/listener.vue\"\nexport default component.exports","import mod from \"-!../../../babel-loader/lib/index.js??ref--1!../../../vue-loader/lib/index.js??vue-loader-options!./listener.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../babel-loader/lib/index.js??ref--1!../../../vue-loader/lib/index.js??vue-loader-options!./listener.vue?vue&type=script&lang=js&\"","export * from \"-!../../../vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../vue-loader/lib/index.js??vue-loader-options!./listener.vue?vue&type=template&id=e57aac98&\"","<template>\n  <div id=\"marko-web-reveal-ad-listener\" />\n</template>\n\n<script>\nimport $ from '@base-cms/marko-web/browser/jquery';\n\nconst parseJson = (str) => {\n  try {\n    return JSON.parse(str);\n  } catch (e) {\n    return {};\n  }\n};\n\nconst target = '_blank';\nconst rel = 'noopener noreferrer';\n\nexport default {\n  props: {\n    target: {\n      type: String,\n      default: '.document-container > .page',\n    },\n    displayFrequency: {\n      type: Number,\n      default: 2,\n    },\n    defaults: {\n      type: Object,\n      default: () => ({ backgroundColor: 'transparent' }),\n    },\n    selectAllTargets: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data: () => ({\n    observed: 0,\n    observer: null,\n    payload: {},\n  }),\n  created() {\n    window.addEventListener('message', this.listener);\n  },\n  beforeDestroy() {\n    window.removeEventListener('message', this.listener);\n    if (this.observer) this.observer.disconnect();\n  },\n  methods: {\n    displayBackground() {\n      const {\n        adClickUrl,\n        backgroundColor,\n        backgroundImagePath,\n      } = this.payload;\n\n      const backgroundImage = `url(\"${backgroundImagePath}\")`;\n      const revealBackground = $('<a>', { href: adClickUrl, target, rel }).addClass('reveal-ad-background').css({ backgroundImage });\n      $('body').css({ backgroundColor }).prepend(revealBackground);\n      $('body').addClass('with-reveal-ad');\n    },\n    displayAd(element) {\n      if (!element) return;\n      const {\n        adClickUrl,\n        adImagePath,\n        adTitle,\n        boxShadow,\n      } = this.payload;\n\n      const adContainer = $('<div>').addClass('reveal-ad');\n      if (boxShadow) adContainer.addClass(`reveal-ad--${boxShadow}-shadow`);\n      adContainer.html($('<a>', {\n        href: adClickUrl,\n        title: adTitle,\n        target,\n        rel,\n      }).append($('<img>', { src: adImagePath, alt: adTitle })));\n      $(element).before(adContainer);\n    },\n    shouldDisplay() {\n      const { displayFrequency } = this;\n      this.observed += 1;\n      return this.observed % displayFrequency > 0;\n    },\n    observeMutations() {\n      if (!window.MutationObserver) return;\n      this.observer = new MutationObserver((mutationList) => {\n        for (let i = 0; i < mutationList.length; i += 1) {\n          const mutation = mutationList[i];\n          if (mutation.type === 'childList') {\n            for (let x = 0; x < mutation.addedNodes.length; x += 1) {\n              const added = mutation.addedNodes[x];\n              if (added.matches && added.matches(this.target)) {\n                if (this.shouldDisplay()) this.displayAd(added);\n              }\n            }\n          }\n        }\n      });\n      const node = document.querySelector(this.target);\n      if (node && node.parentNode) {\n        this.observer.observe(node.parentNode, { childList: true, subtree: true });\n      }\n    },\n    listener(event) {\n      const payload = parseJson(event.data);\n      if (['adImagePath', 'adTitle', 'backgroundImagePath', 'adClickUrl'].every(k => payload[k])) {\n        if (document.readyState === 'loading') {\n          document.addEventListener('DOMContentLoaded', () => this.execute(payload));\n        } else {\n          this.execute(payload);\n        }\n      }\n    },\n    execute(payload) {\n      const elements = this.selectAllTargets\n        ? document.querySelectorAll(this.target) : [document.querySelector(this.target)];\n      this.payload = { ...this.defaults, ...payload };\n      this.displayBackground();\n      for (let i = 0; i < elements.length; i += 1) {\n        this.displayAd(elements[i]);\n      }\n      this.observeMutations();\n      window.removeEventListener('message', this.listener);\n    },\n  },\n};\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"div\", { attrs: { id: \"marko-web-reveal-ad-listener\" } })\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }"],"sourceRoot":""}